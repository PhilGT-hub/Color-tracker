<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crosshair Color Tracker</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
  video, canvas { border: 1px solid #333; margin-top: 10px; }
  #crosshair {
    position: absolute;
    width: 20px;
    height: 20px;
    margin-left: -10px;
    margin-top: -10px;
    pointer-events: none;
    border-left: 1px solid red;
    border-top: 1px solid red;
    border-right: 1px solid red;
    border-bottom: 1px solid red;
  }
  #instructions { margin-top: 10px; }
</style>
</head>
<body>
<h1>Crosshair Color Tracker</h1>
<p id="instructions">Drag the crosshair over the video and click to pick a color to track (exact RGB match).</p>
<video id="video" autoplay playsinline width="320" height="240"></video>
<canvas id="canvas" width="320" height="240"></canvas>
<div id="crosshair"></div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const crosshair = document.getElementById('crosshair');

let targetColor = null; // RGB array
let canvasRect = null;

// Access webcam
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => { video.srcObject = stream; })
  .catch(err => { alert('Error accessing webcam: ' + err); });

// Update crosshair position
document.addEventListener('mousemove', (e) => {
    crosshair.style.left = e.clientX + "px";
    crosshair.style.top = e.clientY + "px";
});

// Pick target color when clicking the crosshair
document.addEventListener('click', (e) => {
    if (!canvasRect) canvasRect = canvas.getBoundingClientRect();
    const x = Math.floor(e.clientX - canvasRect.left);
    const y = Math.floor(e.clientY - canvasRect.top);
    if (x < 0 || y < 0 || x >= canvas.width || y >= canvas.height) return;

    const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const idx = (y * canvas.width + x) * 4;
    targetColor = [frame.data[idx], frame.data[idx+1], frame.data[idx+2]]; // exact RGB
    alert(`Target color picked: rgb(${targetColor.join(',')})`);
});

// Process video frames
function processFrame() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    if (targetColor) {
        const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = frame.data;

        let minX = canvas.width, minY = canvas.height, maxX = 0, maxY = 0;
        let found = false;

        for (let y = 0; y < canvas.height; y++) {
            for (let x = 0; x < canvas.width; x++) {
                const i = (y * canvas.width + x) * 4;
                const r = data[i], g = data[i+1], b = data[i+2];

                if (r === targetColor[0] && g === targetColor[1] && b === targetColor[2]) {
                    found = true;
                    if (x < minX) minX = x;
                    if (y < minY) minY = y;
                    if (x > maxX) maxX = x;
                    if (y > maxY) maxY = y;
                }
            }
        }

        if (found) {
            ctx.strokeStyle = 'lime';
            ctx.lineWidth = 2;
            ctx.strokeRect(minX, minY, maxX - minX, maxY - minY);
        }
    }
    requestAnimationFrame(processFrame);
}

video.addEventListener('play', () => { 
    canvasRect = canvas.getBoundingClientRect();
    processFrame(); 
});
</script>
</body>
</html>
